# 🎵 音乐理论游戏化学习平台开发计划 🎮

## 1. 项目概述
- **愿景**: 将乐理学习做成“好玩、可视化、可坚持”的互动游戏，帮助零基础学员在 4-6 周内建立坚实乐理框架与基本听辨能力。
- **范围**: 基于 README 中的七大模块（音符、节拍、音阶、和弦、调性、音程、综合挑战），提供网页端优先的学习体验，后续扩展到移动端 PWA。
- **成功标准（KPI）**:
  - 次周留存 ≥ 35%
  - 平均每次学习时长 ≥ 12 分钟
  - 完成首条学习路径（音符→节拍→音阶）比例 ≥ 60%
  - 正确率提升（前测→后测）≥ 25%

## 2. 目标用户与场景
- **用户**: 音乐零基础/初学者；自学乐器（钢琴/吉他/声乐）的人群；K12 音乐课堂辅助。
- **场景**: 碎片化学习（手机/PWA）、家庭练习（平板/PC）、课堂投屏（教师端）。

## 3. 功能模块一览（与 README 对齐）

### 🎓 教程系统
1) 基础理论教程（渐进式学习、多感官体验）
2) 视频教学课程（动画演示、真人示范、互动练习）
3) 互动式演示（实时交互、3D可视化、AR/VR体验）
4) 知识图谱（完整知识体系、知识点关联）

### 🎮 游戏化学习模块
1) 基础音符游戏（记忆卡片、连连看）
2) 节拍大师（可视化时值、打击练习）
3) 音阶探险（全半音模式、C 大调地图）
4) 和弦魔法（大小三和弦识别、和弦进行）
5) 调性王国（调号家族树、五度圈）
6) 音程冒险（音程距离与性格卡）
7) 五线谱读写（音符识别、视唱练习）
8) 调式与和声（调式识别、和声构建）
9) 曲式分析（结构拼图、音乐分析）
10) 模块化编曲工坊（Loop 编曲、智能和弦/旋律、卷帘窗、模板/引导）
11) 综合挑战（RPG 关卡、闯关进度与称号）

### 🔧 通用系统
12) 学习路径（个性化学习路径、自适应难度）
13) 进度与成就（多层级成就系统、综合能力评估）
14) 每日任务（分阶段练习计划、学习提醒）
15) 设置与无障碍（多语言支持、无障碍访问）

## 4. 详细设计（模块级）

### 4.0 教程系统设计
#### 4.0.1 基础理论教程
- 目标: 提供系统性的音乐理论知识学习
- 内容: 渐进式课程设计、多感官学习体验
- UI: 章节导航、进度追踪、知识点标注
- 技术: 响应式设计、离线缓存、多语言支持

#### 4.0.2 视频教学课程
- 目标: 通过视频形式提供直观的音乐教学
- 内容: 动画演示、真人示范、互动练习
- UI: 视频播放器、字幕支持、进度控制
- 技术: 视频流媒体、字幕同步、互动标注

#### 4.0.3 互动式演示
- 目标: 提供沉浸式的音乐概念演示
- 内容: 3D可视化、AR/VR体验、实时交互
- UI: 3D场景、交互控制、多视角切换
- 技术: WebGL、Three.js、AR.js、WebXR

#### 4.0.4 知识图谱
- 目标: 构建完整的音乐理论知识体系
- 内容: 知识点关联、学习路径规划、难度分级
- UI: 图谱可视化、节点交互、路径高亮
- 技术: D3.js、图谱算法、推荐系统

### 4.1 基础音符游戏
- 目标: 认识 CDEFGAB 与 DoReMiFaSolLaSi 的映射。
- 玩法: 记忆卡片翻翻看、英文音名↔唱名连线、限时配对赛。
- UI: 卡片网格、进度条、连线轨迹、结果面板（正确/用时）。
- 算法/引擎: 题库随机、干扰项生成、N-back 记忆曲线。
- 数据: 题目 ID、错误项统计、单音听写记录（可选）。

### 4.2 节拍大师
- 目标: 掌握全/二分/四分/八分/十六分音符时值与 3/4、4/4、6/8 基本律动。
- 玩法: 节拍器节奏打击（键盘/触控）、身体打击引导（图标提示）。
- UI: 时间轴光标、点击热区、正确/提前/滞后判定反馈。
- 算法: 时序事件捕捉、量化到最近拍/分拍、偏差评分。
- 技术: WebAudio API（Tone.js）精准时序与节拍器。

### 4.3 音阶探险
- 目标: 记忆大调全半音公式与 C 大调音阶排列。
- 玩法: 地图式推进（全/半音桥）、填空音级、听唱校验。
- UI: 地图节点、桥梁颜色（全=绿、半=红）、提示/复习卡。
- 算法: 自适应复现错题、莱特纳记忆箱（间隔重复）。

### 4.4 和弦魔法
- 目标: 识别大小三和弦，理解功能与常见和弦进行（I–vi–IV–V）。
- 玩法: 听辨大/小三和弦、拖拽构建和弦、伴奏进行拼装。
- UI: 和弦堆叠可视化、功能色彩（明亮/忧郁）、播放控件。
- 算法: 频谱/包络对齐播放、一键转调、和弦正确性判定。

### 4.5 调性王国
- 目标: 认识调号、理解五度圈关系、会用图快速找主音与关系大小调。
- 玩法: 调号识别快问快答、五度圈转盘答题、转调练习。
- UI: 五度圈可交互转盘、调号牌、提示浮层。

### 4.6 音程冒险
- 目标: 识别完全/大/小音程，建立听感联想（性格卡）。
- 玩法: 听辨音程、音高拖拽至距离标尺、情景化问答。
- UI: 标尺/阶梯、音程卡片、配对反馈动画。

### 4.7 综合挑战（RPG）
- 目标: 串联各模块，形成“测→学→练→测”的闭环与称号系统。
- 玩法: 计时冲关、连击加成、失败友好重试、闯关解锁新皮肤。
- UI: 关卡地图、体力/能量、称号与徽章展示。

### 4.8 五线谱读写
- 目标: 掌握五线谱的基本读写技能，能够准确识别和书写音符
- 玩法: 音符位置识别、拖拽练习、视唱训练、谱面分析
- UI: 五线谱显示、音符拖拽、键盘映射、视唱界面
- 算法: 音符位置计算、音高映射、节拍量化、视唱评分
- 数据: 谱面数据、音符位置、音高信息、练习记录

### 4.9 调式与和声
- 目标: 理解调式的概念，掌握基本和声知识
- 玩法: 调式识别、和声构建、和弦进行、调式转换
- UI: 调式选择器、和弦构建器、和声分析图、调式转换器
- 算法: 调式识别、和声分析、和弦进行生成、调式转换
- 数据: 调式数据、和弦库、和声进行、分析结果

### 4.10 曲式分析
- 目标: 理解音乐的结构，学会分析音乐作品
- 玩法: 结构拼图、段落识别、曲式标记、音乐分析
- UI: 音乐波形、结构标记、分析面板、对比视图
- 算法: 音乐分析、结构识别、相似度计算、模式匹配
- 数据: 音乐文件、结构数据、分析结果、对比数据

### 4.11 模块化编曲工坊（核心新增）
- 设计原则：直观性、游戏化、引导式、约束性、即时反馈。
- 子模块：
  1) 预制 Loop 编曲
     - 统一长度（1/2/4 小节），自动匹配当前 BPM/调性
     - 分类：风格（流行/爵士/摇滚/电子）、情绪（明亮/忧郁/力量）
     - 拖拽到时间轴即播放；自动对齐与跨小节拼接
  2) 智能和弦助手
     - 输入根音/风格 → 推荐 I–V–vi–IV 等常见进行（可替换/转位）
     - 点击预听单个和弦或循环播放整段进行；一键转调
  3) 旋律生成器
     - 基于当前和弦与音阶/节拍生成“简单/复杂/明亮/忧郁”旋律
     - 支持再生成、片段拼接、变奏（位移/反向/增值/减值）
  4) 极简钢琴卷帘窗
     - Canvas/SVG 卷帘窗；量化吸附（1/4、1/8、1/16）
     - 工具：铅笔/橡皮/选择；左侧钢琴键试音；拖拽调整时值
  5) 可视化与反馈
     - AnalyserNode 波形/频谱、轨道配色、播放头高亮当前拍点
  6) 模板与互动教程
     - 工程模板（8-Bit、抒情钢琴、Trap Beat 等）；Intro.js/Shepherd.js 新手引导

- 评分与成就：
  - 节拍对齐、调性一致、音量均衡作为基础评分指标
  - 成就：编曲新手、Loop 工匠、和声旅人、旋律炼金师

- 与综合挑战联动：新增“编曲工坊首作”关卡（8 小节、四轨要求）

## 5. 游戏化与动力系统

### 5.1 多层级成就系统
#### 基础成就（入门级）
- 音符新手、节拍学徒、音阶探索者
- 和弦入门者、调性学者、音程专家

#### 进阶成就（进阶级）
- 谱面大师、调式专家、和声学者
- 曲式分析家、编曲新手、视唱达人

#### 高级成就（专家级）
- 理论大师、音乐创作家、分析专家
- 即兴演奏家、风格大师、全能音乐家

### 5.2 综合能力评估
- 理论知识评估（40%）
- 实践技能评估（30%）
- 创作能力评估（20%）
- 分析能力评估（10%）

### 5.3 学习动力机制
- 等级与经验: 练习得分→经验→升级解锁新关卡/皮肤
- 连续打卡: 日历连击奖励；断签保护（一次/月）
- 每日/每周任务: 量化目标（完成 X 题、练习 Y 分钟）
- 进度与路径: 个性化学习路径，自适应难度调整
- 社交元素: 学习排行榜、作品分享、协作学习

## 6. 课程与内容体系

### 6.1 内容模型
- 内容模型：Lesson（课程）→ Exercise（练习）→ Attempt（尝试）
- 教程系统：Tutorial（教程）→ Video（视频）→ Demo（演示）→ Practice（练习）
- 知识图谱：Concept（概念）→ Relation（关系）→ Path（路径）→ Assessment（评估）

### 6.2 题型设计
#### 基础题型
- 选择、连线、拖拽、填空、听辨、打击时序

#### 进阶题型
- 视唱、和声分析、曲式标记、音乐创作、即兴演奏

#### 综合题型
- 作品分析、风格识别、调式判断、和声进行、编曲制作

### 6.3 难度曲线
- 引导式示例 → 基础 → 强化 → 变式 → 综合应用
- 分阶段学习：基础阶段（1-4周）→ 进阶阶段（5-8周）→ 高级阶段（9-12周）

### 6.4 自适应学习
- 错题优先、近期遗忘优先、跨模块穿插巩固
- 个性化学习路径、智能推荐、学习效果评估
- 多感官学习支持、无障碍访问、多语言支持

## 7. 技术方案

### 7.1 前端架构
#### 核心框架
- 框架: React 18 + Vite 5 + TypeScript 5
- 状态管理: Zustand（轻量级状态管理）
- UI框架: Tailwind CSS + Radix UI + Framer Motion
- 路由: React Router v6
- PWA: Workbox（离线题库/音频缓存）

#### 音频处理
- 音频引擎: Web Audio API + Tone.js 14
- 节拍器、合成器、采样播放器
- 音频可视化: AnalyserNode + Canvas/SVG
- 音频分析: Web Audio API + ML.js

#### 可视化技术
- 2D图形: Canvas + SVG + D3.js
- 3D图形: Three.js + WebGL
- AR/VR: AR.js + WebXR
- 动画: Framer Motion + Lottie

#### 教程系统
- 视频播放: Video.js + HLS.js
- 字幕同步: WebVTT
- 互动标注: Canvas + SVG
- 知识图谱: D3.js + 图谱算法

### 7.2 编曲工坊技术栈
- 音频与时序：Tone.js + Web Audio API（Transport/调度/合成/采样）
- 可视化：AnalyserNode + Canvas/SVG/WebGL（波形/频谱）
- 卷帘窗：Canvas/SVG 交互；量化与网格吸附
- 引导与模板：Intro.js/Shepherd.js；工程 JSON（轨道/音色/音符）
- 旋律生成：音阶/和弦内音规则 + 概率模型（马尔可夫链）
- 音频处理：Web Audio API + AudioWorklet
- 实时协作：WebSocket + CRDT

### 7.2 后端与数据
- 选型 A: Firebase（Auth/Firestore/Storage）+ Cloud Functions
- 选型 B: Node.js（NestJS）+ PostgreSQL（Prisma）+ S3 对象存储
- 实时: WebSocket/Firestore onSnapshot 同步练习状态（可选）
- 分析: PostHog/GA4 + BigQuery 导出（事件：开始、完成、正确率、停留时长）

### 7.3 架构（文本示意）
```
[Client React PWA]
  ├─ UI/游戏场景（Canvas/SVG/DOM）
  ├─ 音频时序（Tone.js）
  ├─ 学习逻辑与自适应（TS）
  └─ 缓存（IndexedDB/CacheStorage）

[API 层]
  ├─ Auth（OAuth/Firebase Auth）
  ├─ Progress/Attempt API
  └─ Content CDN（题库/音频静态资源）

[数据层]
  ├─ Firestore/PostgreSQL（用户/进度/成绩/配置）
  └─ Storage（音频/插画/JSON 题库）
```

### 7.4 无障碍与设备适配
- 屏幕阅读支持（aria-label、焦点顺序、可键盘操作）。
- 颜色对比度与色盲安全调色板。
- 触控/键盘双输入；小屏/横屏优化。

### 7.5 安全与隐私
- 最小化收集；事件匿名化；未成年人合规（本地化遵从）。
- 传输全程 HTTPS；鉴权 Token 轮转；速率限制与防刷。

## 8. 数据模型（草案）

### 8.1 用户与进度
- User: id, nickname, avatar, locale, createdAt, preferences
- Progress: userId, moduleKey, level, xp, streak, lastActiveAt, completionRate
- Badge: id, key, title, rarity, earnedAt, category, description
- Achievement: id, userId, badgeId, earnedAt, progress

### 8.2 教程系统
- Tutorial: id, title, description, order, difficulty, category
- Video: id, tutorialId, title, url, duration, subtitles, annotations
- Demo: id, tutorialId, title, type(3d/ar/vr), config, assets
- KnowledgeGraph: id, concept, relations, prerequisites, difficulty

### 8.3 学习内容
- Lesson: id, moduleKey, title, order, goals, prerequisites
- Exercise: id, lessonId, type, payload, difficulty, timeLimit
- Attempt: id, exerciseId, userId, startedAt, finishedAt, score, detail
- Question: id, exerciseId, type, content, options, correctAnswer

### 8.4 编曲工程
- Project: id, userId, title, bpm, key, scale, createdAt, updatedAt, isPublic
- Track: id, projectId, type(drum/bass/chord/melody), color, mute, solo, order
- Clip: id, trackId, startBeat, lengthBeat, kind(loop/midi), refId
- MidiNote: id, clipId, pitch, startBeat, lengthBeat, velocity
- Asset: id, kind(loop/audio/sprite), url, bpm, key, scale, lengthBeat, tags[]

### 8.5 学习分析
- LearningPath: id, userId, path, currentStep, completedSteps, estimatedTime
- Assessment: id, userId, type, score, details, timestamp
- LearningAnalytics: id, userId, event, data, timestamp

示例 Exercise.payload：
```json
{
  "prompt": "将 C 与 Do 配对",
  "options": ["C","D","E","Do","Re","Mi"],
  "pairs": [["C","Do"]],
  "timeLimitSec": 60
}
```

## 9. API 设计（REST/JSON）
- POST /auth/login
- GET /me
- GET /content/lessons?moduleKey=notes
- GET /exercises?lessonId=xxx
- POST /attempts { exerciseId, answers, clientTs }
- PATCH /progress { moduleKey, deltaXp, streak }
- GET /badges

（新增：编曲相关）
- GET /projects
- POST /projects { title, bpm, key, scale }
- GET /projects/:id
- PATCH /projects/:id { title?, bpm?, key?, scale? }
- POST /projects/:id/tracks { type }
- POST /projects/:id/clips { trackId, startBeat, lengthBeat, kind, refId }
- PUT /clips/:id/notes { notes: MidiNote[] }
- GET /assets?tag=pop&kind=loop

## 10. 测试与质量保障
- 单元测试: 逻辑/题目判分/时间量化（Jest）。
- 端到端: 关键路径（首次登录→完成 1 课→领取徽章）（Playwright）。
- 可用性走查: 5 名受试者任务完成率与错误点记录。
- 性能: 首屏 < 2.5s、交互输入响应 < 100ms、音频抖动 < 5ms。

## 11. 内容生产工作流
- 题库格式: JSON/YAML；版本化（SemVer）。
- 资产命名: audio/notes/c4.wav, sprites/chord_major.svg
- 校对流程: 创建→教研审核→听辨校验→上架。
- 本地化: i18next 键值；中文为基础语言，支持英文拓展。

## 12. 指标与实验
- 学习漏斗：进入课程→开始练习→完成练习→领取徽章。
- A/B: 反馈动画强度、提示频率、题量长短。
- 预警: 连续 7 天未登录推送“回归任务”。

## 13. 里程碑与时间表（建议）

### M0 原型阶段（第 1-2 周）
- 基础音符游戏（记忆卡片+连连看）
- 节拍器打击 Demo
- 基础数据模型设计
- 教程系统架构设计

### M1 MVP阶段（第 3-5 周）
- 音符/节拍/音阶三模块可用
- 基础理论教程系统
- 视频教学课程框架
- 账号/进度/徽章系统
- PWA基础功能

### M2 Beta阶段（第 6-8 周）
- 和弦/调性/音程模块上线
- 五线谱读写模块
- 调式与和声模块
- 综合挑战系统
- 自适应练习算法
- 模块化编曲工坊 Alpha（Loop/和弦助手/卷帘基础）

### M3 1.0阶段（第 9-10 周）
- 曲式分析模块
- 互动式演示系统（3D/AR/VR）
- 知识图谱系统
- 性能与无障碍达标
- 教师投屏模式
- 编曲工坊 Beta（旋律生成、模板与新手引导）

### M4 增长阶段（第 11-12 周）
- 新手引导迭代
- 连击任务系统
- 分享卡片功能
- 运营面板
- 分享社区与作品卡片
- 导出音频（.wav）

### M5 高级阶段（第 13-16 周）
- AI辅助学习系统
- 个性化推荐算法
- 社交学习功能
- 多语言支持
- 移动端优化
- 企业/教育版本

## 14. 任务分解（EPIC → Story）

### EPIC A: 教程系统
- 基础理论教程：章节导航、进度追踪、知识点标注
- 视频教学课程：视频播放器、字幕同步、互动标注
- 互动式演示：3D可视化、AR/VR体验、实时交互
- 知识图谱：图谱可视化、节点交互、路径规划

### EPIC B: 音频与时序引擎
- 精准计时与量化、点击判定、延迟补偿、可视化回放
- 多音源管理、混音通道、音频分析
- 实时音频处理、AudioWorklet、Web Audio API

### EPIC C: 题库与自适应
- 题型引擎、难度算法、错题本、间隔重复
- 个性化学习路径、智能推荐、学习效果评估
- 多感官学习支持、无障碍访问

### EPIC D: 游戏化系统
- 多层级成就系统、综合能力评估
- XP/等级、徽章解锁、每日任务、连续打卡
- 社交元素、学习排行榜、作品分享

### EPIC E: 新增知识模块
- 五线谱读写：音符识别、视唱练习、谱面分析
- 调式与和声：调式识别、和声构建、和弦进行
- 曲式分析：结构拼图、音乐分析、模式识别

### EPIC F: UI/UX 与可访问性
- 组件库、触控优化、色弱模式、键盘导航
- 响应式设计、多语言支持、无障碍访问
- 动画系统、交互反馈、用户体验优化

### EPIC G: 基础设施与数据
- 鉴权、进度存储、日志与埋点、PWA 缓存
- 数据模型、API设计、实时同步
- 性能优化、安全防护、隐私保护

## 15. 风险与对策
- Web 音频时序漂移 → 使用 Tone.Transport/提前调度；减少主线程阻塞。
- 低端设备卡顿 → 降级动画、限制并发音频、预加载/懒加载。
- 学习流失 → 强引导路径、即时正反馈、轻度社交对比。
- 内容规模化 → 工具化产出与审核流；社区贡献引导（后期）。
 - 内容规模化 → 工具化产出与审核流；社区贡献引导（后期）。
 - 音频时序抖动 → 采用提前调度、Web Worker/AudioWorklet；避免主线程阻塞。
 - 版权与素材一致性 → 自制/购买授权；统一规范与归一化流程。

## 16. 上线与运维
- 环境: Dev/Stage/Prod；CI/CD（GitHub Actions → Vercel/Netlify）。
- 监控: 前端错误（Sentry）、性能（Web Vitals）、后端健康（Uptime）。
- 隐私合规: 隐私政策、家长监护入口（青少年模式）。

## 17. 路线图（选摘）
- v1.1 听力专项（音程/和弦听辨强化包）
- v1.2 乐器模式（钢琴键盘/吉他指板映射）
- v1.3 社区挑战（每周榜单/班级排行/教师端作业）
- v2.0 AI 教练（错因分析、个性化复习单、语音/唱名纠错）

---

## 附：首批交付清单

### M1 MVP阶段交付清单
- 可运行的 PWA 应用（音符/节拍/音阶三模块）
- 基础理论教程系统（3个章节）
- 视频教学课程框架（5个基础视频）
- 用户登录、进度与徽章、离线缓存
- 10 条示范课程 + 120 道题（含 30 条听辨）
- 指标看板（留存/完成率/正确率）

### M2 Beta阶段交付清单
- 和弦/调性/音程模块完整功能
- 五线谱读写模块基础功能
- 调式与和声模块基础功能
- 综合挑战系统
- 自适应练习算法
- 模块化编曲工坊 Alpha版本

### M3 1.0阶段交付清单
- 曲式分析模块
- 互动式演示系统（3D可视化）
- 知识图谱系统
- 完整的教程体系
- 性能与无障碍达标
- 教师投屏模式

### 长期目标（M4-M5）
- AI辅助学习系统
- 个性化推荐算法
- 社交学习功能
- 多语言支持
- 企业/教育版本
- 移动端原生应用


